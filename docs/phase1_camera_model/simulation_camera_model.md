# 双目相机模型 — 仿真验证文档

## 1. 仿真目的

验证双目相机模型的数学正确性，包括：
- 投影/反投影往返精度
- 畸变正/逆向精度
- 三角测量精度（不同距离）
- 坐标系变换链闭环精度

---

## 2. 仿真环境

- **平台**：Python 3.12 + NumPy 2.3
- **测试框架**：pytest
- **相机参数**：config/default_config.yaml 默认值
  - 焦距 f = 1200 px, 基线 B = 0.3 m

---

## 3. 测试用例矩阵

### 3.1 测试1：投影-反投影往返精度（无畸变）

| 测试点 (X, Y, Z) m | 预期误差 |
|---------------------|----------|
| (0, 0, 100) | < 1e-10 |
| (10, -5, 200) | < 1e-10 |
| (-20, 15, 50) | < 1e-10 |
| (50, 30, 500) | < 1e-10 |
| (1, 1, 2000) | < 1e-10 |

**结果**：✅ 全部通过，往返误差 < 1e-12

### 3.2 测试2：畸变-去畸变往返精度

使用畸变系数 [-0.1, 0.01, 0.001, -0.001, 0.0]：

| 测试点 (X, Y, Z) m | 往返误差 (m) | 像素误差 |
|---------------------|-------------|----------|
| (0, 0, 100) | < 1e-6 | < 0.001 px |
| (5, -3, 200) | < 1e-4 | < 0.01 px |
| (-10, 8, 150) | < 1e-4 | < 0.01 px |

**结果**：✅ 全部通过

### 3.3 测试3：不同距离的立体视差与深度精度

| 距离 Z (m) | 理论视差 d (px) | 视差→深度→视差往返误差 |
|------------|----------------|----------------------|
| 50 | 7.200 | < 1e-10 |
| 100 | 3.600 | < 1e-10 |
| 200 | 1.800 | < 1e-10 |
| 500 | 0.720 | < 1e-10 |
| 1000 | 0.360 | < 1e-10 |

**结果**：✅ 全部通过

### 3.4 测试4：三角测量精度

| 3D 真值 (X, Y, Z) m | 三角测量估计值 | 相对误差 |
|----------------------|---------------|----------|
| (5, -3, 100) | ≈ (5.0, -3.0, 100.0) | < 0.1% |
| (2, 1, 50) | ≈ (2.0, 1.0, 50.0) | < 0.1% |
| (10, -5, 100) | ≈ (10.0, -5.0, 100.0) | < 0.1% |
| (20, 10, 200) | ≈ (20.0, 10.0, 200.0) | < 0.1% |
| (50, -20, 500) | ≈ (50.0, -20.0, 500.0) | < 0.1% |

**结果**：✅ 全部通过（使用标准矫正情况，R=I）

### 3.5 测试5：坐标系变换链闭环

变换链：Camera → Body → NED → Body → Camera

| 初始点 (X_c, Y_c, Z_c) | IMU 姿态 (r, p, y) | 闭环误差 |
|-------------------------|---------------------|----------|
| (5, -2, 200) | (0.1, -0.15, 1.0) | < 1e-10 |
| (100, 50, -30) | (0.1, -0.2, 0.5) | < 1e-10 |

**结果**：✅ 全部通过

### 3.6 测试6：旋转表示往返

| 测试 | 路径 | 精度 |
|------|------|------|
| Euler → Matrix → Euler | 4 组角度 | < 1e-10 |
| Euler → Quaternion → Euler | 3 组角度 | < 1e-10 |
| Quaternion → Matrix → Quaternion | 1 组 | < 1e-10 |
| Rodrigues → Matrix (正交性) | 1 组 | det(R) = 1 ± 1e-12 |

**结果**：✅ 全部通过

---

## 4. 仿真结果汇总

| 测试类别 | 测试数量 | 通过数 | 最大误差 |
|----------|:--------:|:------:|----------|
| 投影往返 | 5 | 5 | < 1e-12 |
| 畸变往返 | 3 | 3 | < 1e-4 |
| 视差-深度 | 5 | 5 | < 1e-10 |
| 三角测量 | 5 | 5 | < 0.1% |
| 坐标变换 | 2 | 2 | < 1e-10 |
| 旋转转换 | 15+ | 15+ | < 1e-10 |
| **总计** | **39** | **39** | **全部通过** |

---

## 5. 结论与建议

1. **相机模型精度满足要求**：所有数学变换的往返精度在双精度浮点数范围内。
2. **畸变模型可靠**：10 次迭代的逆畸变收敛充分，误差 < 0.01 像素。
3. **三角测量在标准矫正情况下精确**：使用简单视差公式即可达到高精度。
4. **建议**：远距离（>200m）应使用融合深度估计方法以补偿视差精度下降。
