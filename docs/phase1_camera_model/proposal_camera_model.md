# 双目相机模型 — 技术方案文档

## 1. 概述与目标

本模块实现双目（立体）相机的数学模型，作为整个仿真系统的基础设施层。
相机模型提供 3D 世界坐标与 2D 像素坐标之间的正反投影能力，以及多种
坐标系之间的变换工具。

### 1.1 主要目标

- 精确建模针孔相机的内参（焦距、主点）和畸变（径向+切向）
- 建模双目相机的外参关系（基线、相对旋转）
- 提供像素↔相机↔体坐标↔NED 坐标的完整变换链
- 提供多种旋转表示法之间的转换工具

---

## 2. 需求分析

### 2.1 功能需求

| 编号 | 需求 | 来源 |
|------|------|------|
| CM-01 | 3D 点投影到左/右相机像素坐标 | 场景生成器 |
| CM-02 | 像素坐标 + 深度反投影到 3D 点 | 位置解算 |
| CM-03 | 双目三角测量 | 立体视觉模块 |
| CM-04 | 镜头畸变正向应用和逆向去除 | 图像预处理 |
| CM-05 | 视差↔深度互算 | 立体匹配 |
| CM-06 | 目标已知尺寸估计深度 | 远距离定位 |
| CM-07 | 坐标系变换链（pixel→cam→body→NED） | 全局 |
| CM-08 | 旋转表示转换（Euler/Matrix/Quaternion/Rodrigues） | 全局 |

### 2.2 精度需求

- 投影正反变换往返误差 < 1e-10（无畸变情况）
- 畸变正反变换误差 < 0.01 像素
- 坐标系变换全链闭环误差 < 1e-10

---

## 3. 候选方案对比

### 3.1 方案A：针孔模型 (Pinhole Model)

- **原理**：中心投影，直线保持直线
- **适用场景**：普通镜头（FOV < 120°）
- **参数**：4 个内参（fx, fy, cx, cy）+ 5 个畸变系数
- **复杂度**：低
- **精度**：高（在适用范围内）

### 3.2 方案B：鱼眼模型 (Fisheye/Equidistant Model)

- **原理**：等距投影 r = f * θ
- **适用场景**：超广角镜头（FOV > 120°）
- **参数**：4 个内参 + 4 个畸变系数（k1~k4）
- **复杂度**：中
- **精度**：高（广角范围）

### 3.3 方案C：全景模型 (Omnidirectional)

- **原理**：统一投影模型（Scaramuzza/Mei）
- **适用场景**：360° 相机
- **参数**：多项式模型，参数多
- **复杂度**：高
- **精度**：高

### 3.4 方案对比矩阵

| 维度 | 针孔模型 | 鱼眼模型 | 全景模型 |
|------|:--------:|:--------:|:--------:|
| 适合 FOV 范围 | < 120° | 120°~180° | 任意 |
| 实现复杂度 | ★ | ★★ | ★★★★ |
| 计算速度 | ★★★★★ | ★★★★ | ★★★ |
| OpenCV 支持 | ★★★★★ | ★★★★ | ★★ |
| FPGA 友好性 | ★★★★★ | ★★★ | ★ |

---

## 4. 推荐方案及理由

**推荐：针孔模型 + Brown-Conrady 畸变**

理由：

1. **任务匹配**：无人机检测任务使用标准镜头（FOV ~70°），针孔模型完全适用
2. **精度足够**：Brown-Conrady 5 参数畸变模型可覆盖典型镜头的畸变特性
3. **实现简单**：投影/反投影公式简洁，便于 FPGA 硬件实现
4. **生态支持**：OpenCV 完全支持，标定工具链成熟

---

## 5. 关键指标与约束

### 5.1 基线距离与深度精度分析

深度误差公式（来自视差精度传播）：

\[
\sigma_Z = \frac{Z^2}{f \cdot B} \cdot \sigma_d
\]

其中 σ_d 为视差测量精度（典型值 0.5 像素）。

| 距离 Z (m) | 视差 d (px) | 深度误差 σ_Z (m) | 相对误差 |
|------------|-------------|------------------|----------|
| 50 | 7.2 | 1.04 | 2.1% |
| 100 | 3.6 | 4.17 | 4.2% |
| 200 | 1.8 | 16.67 | 8.3% |
| 500 | 0.72 | 104.2 | 20.8% |
| 1000 | 0.36 | 416.7 | 41.7% |

> 结论：纯视差法在 200m 以上误差显著增大，需融合尺寸先验。

### 5.2 焦距与视场角

\[
FOV_h = 2 \cdot \arctan\left(\frac{W}{2f_x}\right)
\]

当前参数：f=1200px, W=1920px → FOV_h ≈ 77.3°

---

## 6. 风险评估

| 风险 | 概率 | 影响 | 缓解 |
|------|------|------|------|
| 畸变参数不准影响定位 | 低 | 中 | 仿真中使用已知参数 |
| 极端角度投影退化 | 低 | 低 | 视场角约束 |
| 浮点精度累积误差 | 极低 | 低 | 使用 float64 |

---

## 7. 参考资料

1. Hartley, R. & Zisserman, A. "Multiple View Geometry in Computer Vision."
2. OpenCV Camera Calibration Documentation.
3. Brown, D.C. "Decentering Distortion of Lenses." 1966.
