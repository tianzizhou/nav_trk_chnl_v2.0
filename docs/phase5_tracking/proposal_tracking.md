# 目标跟踪模块 — 技术方案文档

## 1. 概述与目标

多目标跟踪模块对检测到的目标进行状态估计、数据关联和轨迹管理。
在高速 (>1000 km/h) 空战场景下保持跟踪连续性，为位置解算提供
平滑、连续的目标状态估计。

### 1.1 关键挑战

- **帧间位移大**：278 m/s × 1/120s = 2.3 m/帧，在图像中可能跨越数十像素
- **高机动性**：目标可能突然转弯、俯冲、加速，运动模型失配
- **间断检测**：远距离目标存在漏检，跟踪器需要维持预测
- **多目标混杂**：5+目标同时在场，需要正确的 ID 管理
- **新目标/消失目标**：需要快速识别新目标并及时删除消失的轨迹

---

## 2. 需求分析

| 指标 | 目标值 |
|------|--------|
| MOTA (Multi-Object Tracking Accuracy) | > 90% |
| MOTP (Multi-Object Tracking Precision) | < 10m |
| ID Switch (IDSW) | < 5% |
| 轨迹确认延迟 | ≤ 3 帧 |
| 轨迹丢失容忍 | ≥ 5 帧 miss |
| 最大跟踪目标数 | ≥ 20 |

---

## 3. 候选方案对比

### 3.1 滤波算法选型

| 算法 | 非线性处理 | 计算复杂度 | 数值稳定性 | 适用性 |
|------|-----------|-----------|-----------|--------|
| **KF** (卡尔曼滤波) | 线性假设 | O(n²) | ★★★★★ | ★★★ |
| **EKF** (扩展卡尔曼) | 一阶线性化 | O(n²) | ★★★★ | **★★★★** |
| **UKF** (无迹卡尔曼) | Sigma点 | O(n³) | ★★★★ | ★★★★ |
| **粒子滤波** | 蒙特卡洛采样 | O(N·n) | ★★★ | ★★ |

**选择 EKF 的理由**：
- 匀加速运动模型本身是线性的，EKF 等价于标准 KF
- 测量模型（直接观测3D位置）也是线性的
- O(n²) 计算复杂度满足实时需求
- 9维状态空间下 UKF 的 Sigma 点开销不必要

### 3.2 运动模型选型

| 模型 | 状态维度 | 适合场景 | 机动适应性 |
|------|----------|----------|-----------|
| **CV** (匀速) | 6D | 匀速直飞 | ★ |
| **CA** (匀加速) | 9D | 加速/减速 | ★★★ |
| **CT** (协调转弯) | 7D | 定速转弯 | ★★★ |
| **IMM** (交互多模型) | 多模型 | 任意机动 | ★★★★★ |

**选择 CA (匀加速) 模型的理由**：
- 9D 状态直接估计加速度，对匀加速和减速场景有最优响应
- Singer 加速度噪声模型可用于建模未知机动
- 相比 IMM 实现更简单，满足当前仿真需求
- 后续可升级为 IMM 以支持更复杂机动

### 3.3 数据关联方法选型

| 方法 | 全局最优 | 计算复杂度 | 实时性 |
|------|---------|-----------|--------|
| **GNN** (最近邻) | 贪心 | O(N·M) | ★★★★★ |
| **Hungarian** | 全局最优 | O(max(N,M)³) | **★★★★** |
| **JPDA** | 概率加权 | O(exp(N)) | ★★ |
| **MHT** (多假设跟踪) | 延迟决策 | O(exp(N)) | ★ |

**选择 Hungarian 的理由**：
- 全局最优保证不会出现贪心匹配的次优结果
- O(N³) 对 N≤20 目标完全可以实时
- scipy.optimize.linear_sum_assignment 现成实现
- 配合门限过滤避免远距离误关联

### 3.4 轨迹管理策略

| 策略 | 确认方式 | 删除方式 | 复杂度 |
|------|----------|----------|--------|
| **M/N 逻辑** | M帧命中N帧确认 | 连续miss | ★ |
| **得分制** | 累积分达标 | 分数降0 | ★★ |

**选择 M/N 逻辑**（简化为连续命中计数）：简单可靠，参数直观。

---

## 4. 推荐方案总结

**9 维 EKF（匀加速模型）+ Hungarian 全局匹配 + 连续命中/缺失轨迹管理**

### 4.1 高速目标 (>1000 km/h) 的特殊应对

| 挑战 | 应对措施 |
|------|----------|
| 帧间位移大 (2.3m) | 关联门限设为 50m（远大于帧间位移） |
| 加速度不可预测 | Singer 加速度过程噪声 σ=50 m/s² |
| 检测间断 | 5帧 miss 容忍（>40ms 惯性预测） |
| 新目标突然出现 | 3帧即确认（快速响应） |
| 预测驱动搜索 | EKF 预测位置确定下一帧搜索 ROI |

---

## 5. 关键指标与约束

| 指标 | 约束 |
|------|------|
| 单帧跟踪延迟 | < 1ms |
| 内存占用（20轨迹） | < 0.1 MB |
| 最大轨迹数 | 20（可配置） |
| 状态维度 | 9 (pos/vel/acc) |

---

## 6. 风险评估

| 风险 | 概率 | 影响 | 缓解 |
|------|------|------|------|
| 匀加速模型不适合高机动转弯 | 中 | 中 | 加大过程噪声 / 升级 IMM |
| 远距离测量噪声导致滤波发散 | 低 | 高 | 距离自适应 R + P 矩阵监控 |
| 多目标交叉时 ID 切换 | 中 | 中 | 增加外观特征辅助关联 |

---

## 7. 参考资料

1. Bar-Shalom, Y. "Estimation with Applications to Tracking and Navigation." 2001.
2. Singer, R.A. "Estimating Optimal Tracking Filter Performance." IEEE TAC, 1970.
3. Bewley, A. et al. "Simple Online and Realtime Tracking." ICIP, 2016.
4. Kuhn, H.W. "The Hungarian Method for the Assignment Problem." 1955.
