# 立体视觉处理 — 技术方案文档

## 1. 概述与目标

立体视觉模块负责从双目图像对中估计目标的深度（距离），是三维定位的核心环节。

## 2. 需求分析

- 支持 50m ~ 2000m 范围的深度估计
- 近距离精度 < 3%，远距离精度 < 10%（融合后）
- 单帧处理延迟 < 2ms（部署目标，仿真中不硬性要求）

## 3. 候选方案对比

| 方案 | 精度 | 速度 | FPGA友好 | 远距离能力 |
|------|------|------|----------|------------|
| BM (Block Matching) | ★★ | ★★★★★ | ★★★★★ | ★ |
| SGBM (Semi-Global) | ★★★★ | ★★★ | ★★★★ | ★★ |
| RAFT-Stereo (DL) | ★★★★★ | ★★ | ★ | ★★★ |
| 尺寸先验估计 | ★★★ | ★★★★★ | ★★★★★ | ★★★★ |
| **SGBM + 尺寸融合** | ★★★★ | ★★★★ | ★★★★ | **★★★★** |

## 4. 推荐方案

**ROI-SGBM + 尺寸先验融合**：
- 近距离（< 100m）：主要依赖 SGBM 视差（精度高）
- 远距离（> 500m）：主要依赖目标尺寸先验（视差不可靠时）
- 中间距离：两种方法加权融合

## 5. 深度精度理论分析

视差测量误差 σ_d = 0.5 px 时的深度误差 σ_Z = Z² / (f·B) · σ_d：

| 距离 (m) | 视差 (px) | σ_Z (m) | 相对误差 | 融合后误差 |
|----------|-----------|---------|----------|-----------|
| 50 | 7.2 | 1.0 | 2.1% | ~2% |
| 100 | 3.6 | 4.2 | 4.2% | ~3% |
| 200 | 1.8 | 16.7 | 8.3% | ~6% |
| 500 | 0.72 | 104 | 20.8% | ~8% |
| 1000 | 0.36 | 417 | 41.7% | ~10% |

## 6. 风险评估

| 风险 | 缓解 |
|------|------|
| 天空背景纹理不足导致SGBM失败 | 使用尺寸先验作为fallback |
| 目标实际尺寸未知 | 使用统计平均值 + 多帧滤波 |
