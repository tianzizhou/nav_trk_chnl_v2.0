# 位置解算模块 — 仿真验证文档

## 1. 仿真目的

验证方位角、俯仰角、斜距、TTC 和威胁评估的计算正确性。

---

## 2. 测试用例与结果

### 2.1 测试1：8个标准方位的方位角精度

| 目标位置 (X, Y, Z) | 理论方位角 | 实测方位角 | 误差 | 状态 |
|--------------------|-----------|-----------|------|:----:|
| (0, 0, 500) | 0.0° | 0.0° | 0.0° | ✅ |
| (100, 0, 100) | +45.0° | +45.0° | 0.0° | ✅ |
| (-100, 0, 100) | -45.0° | -45.0° | 0.0° | ✅ |

### 2.2 测试2：俯仰角精度

| 目标位置 (X, Y, Z) | 理论俯仰角 | 实测 | 误差 | 状态 |
|--------------------|-----------|------|------|:----:|
| (0, -100, 100) | +45.0° (上方) | +45.0° | 0.0° | ✅ |
| (0, 100, 100) | -45.0° (下方) | -45.0° | 0.0° | ✅ |

### 2.3 测试3：斜距精度

| 目标位置 (X, Y, Z) | 理论斜距 | 实测 | 误差 | 状态 |
|--------------------|---------|------|------|:----:|
| (300, 400, 0) | 500.0m | 500.0m | 0.0m | ✅ |

### 2.4 测试4：TTC 精度（迎头场景）

| 距离 | 接近速度 | 理论 TTC | 实测 TTC | 误差 | 状态 |
|------|---------|---------|---------|------|:----:|
| 1000m | 100 m/s | 10.0s | 10.0s | 0.0s | ✅ |

### 2.5 测试5：远离目标 TTC

| 距离 | 速度方向 | 理论 TTC | 实测 TTC | 状态 |
|------|---------|---------|---------|:----:|
| 1000m | 远离 | ∞ | ∞ | ✅ |

### 2.6 测试6：威胁评估分级

| TTC | 预期等级 | 实测等级 | 状态 |
|-----|---------|---------|:----:|
| 1.0s | critical | critical | ✅ |
| 3.0s | warning | warning | ✅ |
| 10.0s | safe | safe | ✅ |

### 2.7 测试7：多目标同时解算

输入3个不同位置的轨迹 → 输出3个报告，ID正确。

| 结果 | 3个报告，ID={1,2,3} | ✅ |

### 2.8 测试8：NED坐标变换（水平飞行）

水平飞行 (roll=pitch=yaw=0) 时 NED 位置非空。

| 结果 | position_ned 有效 | ✅ |

### 2.9 测试9：斜向接近速度分解

目标在 (100, 0, 100)，速度 (-10, 0, -10)：
- 距离 = 141.4m
- 单位向量 = (0.707, 0, 0.707)
- 径向速度 = -(-10×0.707 + 0 + -10×0.707) = 14.14 m/s

| 理论接近速度 | 14.14 m/s |
|-------------|-----------|
| 实测接近速度 | 14.14 m/s |
| 状态 | ✅ 误差 < 0.5 m/s |

### 2.10 测试10：静态方法调用

compute_azimuth / compute_elevation / compute_slant_range / compute_ttc
均返回有效浮点数。

| 状态 | ✅ |

---

## 3. 端到端场景验证

以 S1 正面迎头场景为例（目标在正前方接近）：

| 帧 | 距离 (m) | 方位角 | 俯仰角 | TTC | 威胁 |
|----|---------|--------|--------|-----|------|
| 初始 | ~2000 | ~0° | ~0° | ~14s | safe |
| 中期 | ~1000 | ~0° | ~0° | ~7s | safe |
| 后期 | ~500 | ~0° | ~0° | ~3.5s | warning |
| 末期 | ~200 | ~0° | ~0° | ~1.4s | critical |

符合预期：正面迎头方位角始终 ~0°，TTC 随距离减小而减小。

---

## 4. 结果汇总

| 测试类别 | 测试数 | 通过数 | 状态 |
|----------|:------:|:------:|:----:|
| 方位角精度 | 3 | 3 | ✅ |
| 俯仰角精度 | 2 | 2 | ✅ |
| 斜距精度 | 1 | 1 | ✅ |
| TTC精度 | 2 | 2 | ✅ |
| 威胁评估 | 3 | 3 | ✅ |
| 多目标 | 1 | 1 | ✅ |
| NED变换 | 1 | 1 | ✅ |
| 接近速度 | 1 | 1 | ✅ |
| 静态方法 | 1 | 1 | ✅ |
| **总计** | **15** | **15** | **全部通过** |

---

## 5. 结论

1. 所有几何计算精度在双精度浮点范围内，满足设计要求
2. TTC 线性模型在匀速接近假设下精确
3. 威胁评估分级逻辑正确
4. 方位角精度 < 0.01°（理论输入下），远优于 0.5° 设计要求
