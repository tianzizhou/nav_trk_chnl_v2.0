# 接口协议与数据格式定义

## 1 文档信息

| 项目 | 内容 |
|------|------|
| 文档编号 | CUAV-ICD-007 |
| 版本 | V1.0.0 |
| 日期 | 2026-02-20 |

---

## 2 概述

本文档定义多模态融合反无人机探测系统内部各模块之间、以及系统与
外部指控/打击系统之间的接口协议、消息格式和数据定义。

### 2.1 接口关系总览

```
┌───────────────────────────────────────────────────────────────┐
│                         外部接口                              │
│                                                               │
│  ┌──────────┐                              ┌──────────────┐   │
│  │ 指控系统 │◀─── IF-01: 航迹报告 ────────│              │   │
│  │ (上级)   │──── IF-02: 控制指令 ────────▶│              │   │
│  └──────────┘                              │              │   │
│                                            │   融合处理   │   │
│  ┌──────────┐                              │   平台       │   │
│  │ 打击系统 │◀─── IF-03: 引导数据 ────────│              │   │
│  └──────────┘                              │              │   │
│                                            │              │   │
├────────────────────────────────────────────│──────────────│───┤
│                         内部接口           │              │   │
│                                            │              │   │
│  ┌──────────┐                              │              │   │
│  │ 雷达     │──── IF-11: 雷达量测 ────────▶│              │   │
│  └──────────┘                              │              │   │
│  ┌──────────┐                              │              │   │
│  │ 光电     │──── IF-12: 光电量测 ────────▶│              │   │
│  │          │◀─── IF-22: 光电引导 ────────│              │   │
│  └──────────┘                              │              │   │
│  ┌──────────┐                              │              │   │
│  │ 声学     │──── IF-13: 声学量测 ────────▶│              │   │
│  └──────────┘                              │              │   │
│  ┌──────────┐                              │              │   │
│  │ RF侦测   │──── IF-14: RF量测 ──────────▶│              │   │
│  └──────────┘                              │              │   │
│                                            │              │   │
│  ┌──────────┐                              │              │   │
│  │ GPS/北斗 │──── IF-30: 授时/定位 ────────▶│              │   │
│  └──────────┘                              └──────────────┘   │
└───────────────────────────────────────────────────────────────┘
```

---

## 3 通信协议栈

### 3.1 物理层与传输层

| 接口 | 物理层 | 传输层 | 说明 |
|------|--------|--------|------|
| IF-01/02 | 千兆以太网 | UDP/TCP | 指控接口 |
| IF-03 | 千兆以太网 / RS422 | UDP / 自定义串口协议 | 打击引导 |
| IF-11~14 | 千兆以太网 | UDP | 传感器内部 |
| IF-22 | 千兆以太网 | UDP | 传感器控制 |
| IF-30 | RS232 | NMEA/1PPS | 授时 |

### 3.2 以太网配置

| 参数 | 值 |
|------|-----|
| IP 地址分配 | 192.168.10.x (内部网段) |
| 融合平台 | 192.168.10.1 |
| 雷达 | 192.168.10.11 |
| 光电 | 192.168.10.12 |
| 声学 | 192.168.10.13 |
| RF侦测 | 192.168.10.14 |
| 指控接口 | 192.168.20.1 (外部网段) |
| UDP 基础端口 | 50000 |
| 子网掩码 | 255.255.255.0 |

---

## 4 消息通用格式

### 4.1 消息帧结构

所有消息采用统一的帧结构，**小端序（Little-Endian）**：

```
┌──────────────────────────────────────────────────────┐
│ 字段         │ 类型      │ 偏移  │ 长度  │ 说明     │
├──────────────────────────────────────────────────────┤
│ sync_word    │ uint16    │ 0     │ 2     │ 0xEB90   │
│ msg_id       │ uint16    │ 2     │ 2     │ 消息标识 │
│ msg_length   │ uint16    │ 4     │ 2     │ 载荷长度 │
│ source_id    │ uint8     │ 6     │ 1     │ 发送方   │
│ dest_id      │ uint8     │ 7     │ 1     │ 接收方   │
│ timestamp_ms │ uint32    │ 8     │ 4     │ GPS时间  │
│ seq_num      │ uint16    │ 12    │ 2     │ 序列号   │
│ reserved     │ uint16    │ 14    │ 2     │ 保留     │
├──────────────────────────────────────────────────────┤
│ payload      │ variable  │ 16    │ N     │ 有效载荷 │
├──────────────────────────────────────────────────────┤
│ checksum     │ uint16    │ 16+N  │ 2     │ CRC-16   │
├──────────────────────────────────────────────────────┤
│ 总长度: 18 + N 字节                                  │
└──────────────────────────────────────────────────────┘
```

### 4.2 设备 ID 定义

| ID | 设备 |
|----|------|
| 0x01 | 融合处理平台 |
| 0x11 | FMCW 雷达 |
| 0x12 | 光电系统 |
| 0x13 | 声学阵列 |
| 0x14 | RF 侦测 |
| 0x21 | 指控系统 |
| 0x31 | 打击系统 1 (火工) |
| 0x32 | 打击系统 2 (激光) |
| 0x33 | 打击系统 3 (微波) |
| 0xFF | 广播 |

### 4.3 CRC-16 校验

采用 CRC-16/MODBUS 算法：
- 多项式: 0xA001
- 初始值: 0xFFFF
- 校验范围: sync_word 到 payload 末尾

---

## 5 内部接口消息定义

### 5.1 IF-11: 雷达量测报告

**msg_id**: 0x0101

**发送方**: 雷达 (0x11) → 融合 (0x01)

**周期**: 200 ms

**载荷格式**:

```
┌──────────────────────────────────────────────────────┐
│ 字段             │ 类型      │ 偏移  │ 长度  │ 单位  │
├──────────────────────────────────────────────────────┤
│ frame_id         │ uint32    │ 0     │ 4     │ -     │
│ plot_count       │ uint16    │ 4     │ 2     │ -     │
│ scan_mode        │ uint8     │ 6     │ 1     │ -     │
│ reserved         │ uint8     │ 7     │ 1     │ -     │
├──── 以下为 plot_count 个点迹, 每个 32 字节 ─────────┤
│ plot[i].range_m         │ float32 │ +0   │ 4  │ m    │
│ plot[i].azimuth_rad     │ float32 │ +4   │ 4  │ rad  │
│ plot[i].elevation_rad   │ float32 │ +8   │ 4  │ rad  │
│ plot[i].radial_vel_mps  │ float32 │ +12  │ 4  │ m/s  │
│ plot[i].snr_dB          │ float32 │ +16  │ 4  │ dB   │
│ plot[i].rcs_dBsm        │ float32 │ +20  │ 4  │ dBsm │
│ plot[i].hover_flag      │ uint8   │ +24  │ 1  │ 0/1  │
│ plot[i].clutter_flag    │ uint8   │ +25  │ 1  │ 0/1  │
│ plot[i].quality         │ uint8   │ +26  │ 1  │ 0-100│
│ plot[i].reserved        │ uint8   │ +27  │ 1  │ -    │
│ plot[i].timestamp_us    │ uint32  │ +28  │ 4  │ μs   │
└──────────────────────────────────────────────────────┘
```

**消息总长**: 8 + 32 × plot_count 字节

**scan_mode 定义**:

| 值 | 模式 |
|----|------|
| 0 | 全向搜索 (360°) |
| 1 | 扇区搜索 |
| 2 | 近距高分辨 |
| 3 | 微多普勒检测 |

### 5.2 IF-12: 光电跟踪报告

**msg_id**: 0x0201

**发送方**: 光电 (0x12) → 融合 (0x01)

**周期**: 33 ms (30 Hz)

**载荷格式**:

```
┌──────────────────────────────────────────────────────┐
│ 字段              │ 类型      │ 偏移  │ 长度 │ 单位  │
├──────────────────────────────────────────────────────┤
│ track_count       │ uint8     │ 0     │ 1    │ -     │
│ camera_id         │ uint8     │ 1     │ 1    │ -     │
│ gimbal_az_rad     │ float32   │ 2     │ 4    │ rad   │
│ gimbal_el_rad     │ float32   │ 6     │ 4    │ rad   │
│ fov_mode          │ uint8     │ 10    │ 1    │ -     │
│ reserved          │ uint8     │ 11    │ 1    │ -     │
├──── 以下为 track_count 个目标, 每个 40 字节 ────────┤
│ target[i].azimuth_rad     │ float32 │ +0  │ 4  │ rad  │
│ target[i].elevation_rad   │ float32 │ +4  │ 4  │ rad  │
│ target[i].az_sigma_rad    │ float32 │ +8  │ 4  │ rad  │
│ target[i].el_sigma_rad    │ float32 │ +12 │ 4  │ rad  │
│ target[i].pixel_u         │ uint16  │ +16 │ 2  │ px   │
│ target[i].pixel_v         │ uint16  │ +18 │ 2  │ px   │
│ target[i].bbox_w          │ uint16  │ +20 │ 2  │ px   │
│ target[i].bbox_h          │ uint16  │ +22 │ 2  │ px   │
│ target[i].confidence      │ float32 │ +24 │ 4  │ 0-1  │
│ target[i].target_class    │ uint8   │ +28 │ 1  │ -    │
│ target[i].track_status    │ uint8   │ +29 │ 1  │ -    │
│ target[i].angular_rate    │ float32 │ +30 │ 4  │ °/s  │
│ target[i].eo_track_id     │ uint16  │ +34 │ 2  │ -    │
│ target[i].reserved        │ uint32  │ +36 │ 4  │ -    │
└──────────────────────────────────────────────────────┘
```

**camera_id 定义**:

| 值 | 相机 |
|----|------|
| 0 | 窄视场可见光 |
| 1 | 窄视场红外 |
| 2 | 广角可见光 |

**fov_mode 定义**:

| 值 | 模式 |
|----|------|
| 0 | 窄视场跟踪 |
| 1 | 广角跟踪 |
| 2 | 搜索模式 |

**track_status 定义**:

| 值 | 状态 |
|----|------|
| 0 | 搜索中 |
| 1 | 跟踪中 |
| 2 | 丢失 (外推) |
| 3 | 重新捕获中 |

### 5.3 IF-13: 声学 DOA 报告

**msg_id**: 0x0301

**发送方**: 声学 (0x13) → 融合 (0x01)

**周期**: 100 ms (10 Hz)

**载荷格式**:

```
┌──────────────────────────────────────────────────────┐
│ 字段              │ 类型      │ 偏移  │ 长度 │ 单位  │
├──────────────────────────────────────────────────────┤
│ source_count      │ uint8     │ 0     │ 1    │ -     │
│ env_noise_dB      │ float32   │ 1     │ 4    │ dB    │
│ reserved          │ uint8[3]  │ 5     │ 3    │ -     │
├──── 以下为 source_count 个声源, 每个 48 字节 ───────┤
│ src[i].azimuth_rad      │ float32  │ +0   │ 4  │ rad  │
│ src[i].elevation_rad    │ float32  │ +4   │ 4  │ rad  │
│ src[i].az_sigma_rad     │ float32  │ +8   │ 4  │ rad  │
│ src[i].el_sigma_rad     │ float32  │ +12  │ 4  │ rad  │
│ src[i].snr_dB           │ float32  │ +16  │ 4  │ dB   │
│ src[i].confidence       │ float32  │ +20  │ 4  │ 0-1  │
│ src[i].target_class     │ uint8    │ +24  │ 1  │ -    │
│ src[i].class_confidence │ float32  │ +25  │ 4  │ 0-1  │
│ src[i].mfcc[0:4]        │ float32×5│ +29  │ 20 │ -    │
│   (前5个MFCC系数,用于分类融合)                       │
└──────────────────────────────────────────────────────┘
```

**target_class 定义**（所有传感器通用）:

| 值 | 类别 |
|----|------|
| 0 | 未知 |
| 1 | 多旋翼无人机 |
| 2 | 固定翼无人机 |
| 3 | 鸟类 |
| 4 | 其他飞行物 |
| 5 | 环境噪声 |

### 5.4 IF-14: RF 信号报告

**msg_id**: 0x0401

**发送方**: RF (0x14) → 融合 (0x01)

**周期**: 50 ms (20 Hz)

**载荷格式**:

```
┌──────────────────────────────────────────────────────┐
│ 字段              │ 类型      │ 偏移  │ 长度 │ 单位  │
├──────────────────────────────────────────────────────┤
│ signal_count      │ uint8     │ 0     │ 1    │ -     │
│ scan_status       │ uint8     │ 1     │ 1    │ -     │
│ reserved          │ uint16    │ 2     │ 2    │ -     │
├──── 以下为 signal_count 个信号, 每个 28 字节 ───────┤
│ sig[i].azimuth_rad      │ float32  │ +0   │ 4  │ rad  │
│ sig[i].az_sigma_rad     │ float32  │ +4   │ 4  │ rad  │
│ sig[i].frequency_MHz    │ float32  │ +8   │ 4  │ MHz  │
│ sig[i].bandwidth_MHz    │ float32  │ +12  │ 4  │ MHz  │
│ sig[i].rssi_dBm         │ float32  │ +16  │ 4  │ dBm  │
│ sig[i].protocol_id      │ uint8    │ +20  │ 1  │ -    │
│ sig[i].confidence       │ uint8    │ +21  │ 1  │ 0-100│
│ sig[i].is_controller    │ uint8    │ +22  │ 1  │ 0/1  │
│ sig[i].reserved         │ uint8    │ +23  │ 1  │ -    │
│ sig[i].rf_track_id      │ uint16   │ +24  │ 2  │ -    │
│ sig[i].reserved2        │ uint16   │ +26  │ 2  │ -    │
└──────────────────────────────────────────────────────┘
```

**protocol_id 定义**:

| 值 | 协议 |
|----|------|
| 0 | 未识别 |
| 1 | DJI OcuSync |
| 2 | DJI Lightbridge |
| 3 | ELRS |
| 4 | DSMX |
| 5 | WiFi (802.11) |
| 6 | 其他已知协议 |

### 5.5 IF-22: 光电引导指令

**msg_id**: 0x2001

**发送方**: 融合 (0x01) → 光电 (0x12)

**周期**: 实时（事件触发，最高 50 Hz）

**载荷格式**:

```
┌──────────────────────────────────────────────────────┐
│ 字段              │ 类型      │ 偏移  │ 长度 │ 单位  │
├──────────────────────────────────────────────────────┤
│ command_type      │ uint8     │ 0     │ 1    │ -     │
│ priority          │ uint8     │ 1     │ 1    │ 0-10  │
│ target_track_id   │ uint16    │ 2     │ 2    │ -     │
│ target_az_rad     │ float32   │ 4     │ 4    │ rad   │
│ target_el_rad     │ float32   │ 8     │ 4    │ rad   │
│ search_window_deg │ float32   │ 12    │ 4    │ deg   │
│ fov_request       │ uint8     │ 16    │ 1    │ -     │
│ reserved          │ uint8[3]  │ 17    │ 3    │ -     │
└──────────────────────────────────────────────────────┘
```

**command_type 定义**:

| 值 | 命令 |
|----|------|
| 0 | 停止/待命 |
| 1 | 引导搜索 (指向目标方向搜索) |
| 2 | 跟踪锁定 (锁定指定目标) |
| 3 | 扫描巡视 (自动扫描) |
| 4 | 切换视场 |

### 5.6 IF-23: 雷达模式控制指令

**msg_id**: 0x2002

**发送方**: 融合 (0x01) → 雷达 (0x11)

**周期**: 实时（事件触发）

**载荷格式**:

```
┌──────────────────────────────────────────────────────┐
│ 字段              │ 类型      │ 偏移  │ 长度 │ 单位  │
├──────────────────────────────────────────────────────┤
│ mode_request      │ uint8     │ 0     │ 1    │ -     │
│ sector_start_deg  │ float32   │ 1     │ 4    │ deg   │
│ sector_end_deg    │ float32   │ 5     │ 4    │ deg   │
│ micro_doppler_en  │ uint8     │ 9     │ 1    │ 0/1   │
│ clutter_map_en    │ uint8     │ 10    │ 1    │ 0/1   │
│ reserved          │ uint8     │ 11    │ 1    │ -     │
│ md_beam_az_rad    │ float32   │ 12    │ 4    │ rad   │
│ md_beam_el_rad    │ float32   │ 16    │ 4    │ rad   │
└──────────────────────────────────────────────────────┘
```

---

## 6 外部接口消息定义

### 6.1 IF-01: 融合航迹报告（融合 → 指控）

**msg_id**: 0x1001

**发送方**: 融合 (0x01) → 指控 (0x21)

**周期**: 200 ms (5 Hz)

**载荷格式**:

```
┌──────────────────────────────────────────────────────┐
│ 字段              │ 类型      │ 偏移  │ 长度 │ 单位  │
├──────────────────────────────────────────────────────┤
│ system_status     │ uint8     │ 0     │ 1    │ -     │
│ track_count       │ uint8     │ 1     │ 1    │ -     │
│ scene_type        │ uint8     │ 2     │ 1    │ -     │
│ reserved          │ uint8     │ 3     │ 1    │ -     │
│ platform_lat_deg  │ float64   │ 4     │ 8    │ deg   │
│ platform_lon_deg  │ float64   │ 12    │ 8    │ deg   │
│ platform_alt_m    │ float32   │ 20    │ 4    │ m     │
│ platform_heading  │ float32   │ 24    │ 4    │ rad   │
├──── 以下为 track_count 个航迹, 每个 80 字节 ────────┤
│ trk[i].track_id          │ uint16   │ +0   │ 2  │ -    │
│ trk[i].track_status      │ uint8    │ +2   │ 1  │ -    │
│ trk[i].target_class      │ uint8    │ +3   │ 1  │ -    │
│ trk[i].pos_e_m           │ float32  │ +4   │ 4  │ m    │
│ trk[i].pos_n_m           │ float32  │ +8   │ 4  │ m    │
│ trk[i].pos_u_m           │ float32  │ +12  │ 4  │ m    │
│ trk[i].vel_e_mps         │ float32  │ +16  │ 4  │ m/s  │
│ trk[i].vel_n_mps         │ float32  │ +20  │ 4  │ m/s  │
│ trk[i].vel_u_mps         │ float32  │ +24  │ 4  │ m/s  │
│ trk[i].range_m           │ float32  │ +28  │ 4  │ m    │
│ trk[i].azimuth_rad       │ float32  │ +32  │ 4  │ rad  │
│ trk[i].elevation_rad     │ float32  │ +36  │ 4  │ rad  │
│ trk[i].speed_mps         │ float32  │ +40  │ 4  │ m/s  │
│ trk[i].heading_rad       │ float32  │ +44  │ 4  │ rad  │
│ trk[i].cep_m             │ float32  │ +48  │ 4  │ m    │
│ trk[i].class_confidence  │ float32  │ +52  │ 4  │ 0-1  │
│ trk[i].threat_score      │ float32  │ +56  │ 4  │ 0-1  │
│ trk[i].threat_level      │ uint8    │ +60  │ 1  │ 0-3  │
│ trk[i].behavior_pattern  │ uint8    │ +61  │ 1  │ -    │
│ trk[i].sensor_contrib    │ uint8    │ +62  │ 1  │ bitmap│
│ trk[i].update_quality    │ uint8    │ +63  │ 1  │ 0-100│
│ trk[i].lat_deg           │ float64  │ +64  │ 8  │ deg  │
│ trk[i].lon_deg           │ float64  │ +72  │ 8  │ deg  │
└──────────────────────────────────────────────────────┘
```

**system_status 定义**:

| 位 | 含义 |
|----|------|
| bit 0 | 系统正常 (1=正常) |
| bit 1 | 雷达在线 |
| bit 2 | 光电在线 |
| bit 3 | 声学在线 |
| bit 4 | RF在线 |
| bit 5 | GPS授时有效 |
| bit 6-7 | 保留 |

**track_status 定义**:

| 值 | 状态 |
|----|------|
| 0 | 暂态 (未确认) |
| 1 | 确认 (跟踪中) |
| 2 | 外推 (推测位置) |
| 3 | 丢失 (即将删除) |

**threat_level 定义**:

| 值 | 等级 | 颜色 |
|----|------|------|
| 0 | 低威胁 | 绿色 |
| 1 | 中威胁 | 黄色 |
| 2 | 中高威胁 | 橙色 |
| 3 | 高威胁 | 红色 |

**behavior_pattern 定义**:

| 值 | 行为 |
|----|------|
| 0 | 未判定 |
| 1 | 直飞接近 |
| 2 | 环绕侦察 |
| 3 | 蛙跳接近 |
| 4 | 悬停观察 |
| 5 | 远距徘徊 |

**sensor_contrib 位图**:

| 位 | 传感器 |
|----|--------|
| bit 0 | 雷达 |
| bit 1 | 光电 |
| bit 2 | 声学 |
| bit 3 | RF |

### 6.2 IF-02: 指控控制指令（指控 → 融合）

**msg_id**: 0x3001

**发送方**: 指控 (0x21) → 融合 (0x01)

**周期**: 实时

**载荷格式**:

```
┌──────────────────────────────────────────────────────┐
│ 字段              │ 类型      │ 偏移  │ 长度 │ 单位  │
├──────────────────────────────────────────────────────┤
│ command_type      │ uint8     │ 0     │ 1    │ -     │
│ param1            │ uint8     │ 1     │ 1    │ -     │
│ param2            │ uint16    │ 2     │ 2    │ -     │
│ param3_float      │ float32   │ 4     │ 4    │ -     │
│ param4_float      │ float32   │ 8     │ 4    │ -     │
│ reserved          │ uint32    │ 12    │ 4    │ -     │
└──────────────────────────────────────────────────────┘
```

**command_type 定义**:

| 值 | 命令 | param说明 |
|----|------|---------|
| 0 | 系统开机 | - |
| 1 | 系统关机 | - |
| 2 | 全向搜索 | - |
| 3 | 扇区搜索 | param3=起始方位, param4=终止方位 |
| 4 | 跟踪指定目标 | param2=track_id |
| 5 | 取消跟踪 | param2=track_id |
| 6 | 静默模式(关雷达) | param1: 0=关闭, 1=启用 |
| 7 | 设置工作模式 | param1=模式编号 |
| 8 | 设置打击引导目标 | param2=track_id |
| 9 | 取消打击引导 | param2=track_id |
| 10 | 系统自检 | - |

### 6.3 IF-03: 打击引导数据（融合 → 打击）

**msg_id**: 0x1002

**发送方**: 融合 (0x01) → 打击 (0x31/32/33)

**周期**: 20 ms (50 Hz)，仅在打击引导模式下

**载荷格式**:

```
┌──────────────────────────────────────────────────────┐
│ 字段              │ 类型      │ 偏移  │ 长度 │ 单位  │
├──────────────────────────────────────────────────────┤
│ guide_status      │ uint8     │ 0     │ 1    │ -     │
│ target_count      │ uint8     │ 1     │ 1    │ -     │
│ reserved          │ uint16    │ 2     │ 2    │ -     │
├──── 以下为 target_count 个引导目标, 每个 48 字节 ───┤
│ tgt[i].track_id         │ uint16   │ +0   │ 2  │ -    │
│ tgt[i].guide_quality    │ uint8    │ +2   │ 1  │ 0-100│
│ tgt[i].target_class     │ uint8    │ +3   │ 1  │ -    │
│ tgt[i].pos_e_m          │ float32  │ +4   │ 4  │ m    │
│ tgt[i].pos_n_m          │ float32  │ +8   │ 4  │ m    │
│ tgt[i].pos_u_m          │ float32  │ +12  │ 4  │ m    │
│ tgt[i].vel_e_mps        │ float32  │ +16  │ 4  │ m/s  │
│ tgt[i].vel_n_mps        │ float32  │ +20  │ 4  │ m/s  │
│ tgt[i].vel_u_mps        │ float32  │ +24  │ 4  │ m/s  │
│ tgt[i].pred_pos_e_m     │ float32  │ +28  │ 4  │ m    │
│ tgt[i].pred_pos_n_m     │ float32  │ +32  │ 4  │ m    │
│ tgt[i].pred_pos_u_m     │ float32  │ +36  │ 4  │ m    │
│ tgt[i].pred_time_ms     │ uint32   │ +40  │ 4  │ ms   │
│ tgt[i].cep_m            │ float32  │ +44  │ 4  │ m    │
└──────────────────────────────────────────────────────┘
```

**说明**：
- `pred_pos_*` 为预测位置（飞行时间补偿后的位置）
- `pred_time_ms` 为预测有效时间（打击系统应在此时间内使用）
- `guide_quality` 为引导质量（100=最佳，<30 应暂停打击）

**guide_status 定义**:

| 值 | 状态 |
|----|------|
| 0 | 引导无效 |
| 1 | 引导有效 |
| 2 | 引导精度降级 |
| 3 | 目标丢失，使用外推 |

---

## 7 GPS/北斗授时接口

### 7.1 IF-30: GPS 授时

**物理接口**: RS232 + 1PPS 脉冲

**NMEA 协议**: 使用 $GPRMC 语句获取 UTC 时间

```
$GPRMC,hhmmss.ss,A,llll.lll,a,yyyyy.yyy,b,x.x,y.y,ddmmyy,...*hh
```

**1PPS 脉冲**: 上升沿精确对齐 UTC 整秒

**内部时间表示**:

系统内部时间统一使用 GPS 周内毫秒数：

\[
timestamp\_ms = GPS\_week\_ms + TOW\_ms
\]

所有消息的 timestamp_ms 字段均使用此格式。

---

## 8 数据记录格式

### 8.1 记录内容

系统运行时自动记录以下数据到 SSD：

| 数据类型 | 记录率 | 预估大小 (每小时) |
|---------|--------|------------------|
| 原始雷达点迹 | 5 Hz | ~36 KB |
| 原始光电报告 | 30 Hz | ~216 KB |
| 原始声学报告 | 10 Hz | ~173 KB |
| 原始RF报告 | 20 Hz | ~58 KB |
| 融合航迹数据 | 5 Hz | ~1.4 MB |
| 打击引导数据 | 50 Hz | ~864 KB |
| 系统状态日志 | 1 Hz | ~3.6 KB |
| **总计** | | **~2.8 MB/h** |

### 8.2 记录文件格式

采用二进制文件格式，每条记录前缀 8 字节头：

```
┌──────────────────────────────────────────┐
│ 字段           │ 类型     │ 长度 │ 说明  │
├──────────────────────────────────────────┤
│ record_type    │ uint16   │ 2    │ 类型  │
│ record_length  │ uint16   │ 2    │ 长度  │
│ timestamp_ms   │ uint32   │ 4    │ 时间  │
│ data           │ variable │ N    │ 原始  │
│                │          │      │ 消息  │
└──────────────────────────────────────────┘
```

---

## 9 接口测试要求

### 9.1 接口测试项目

| 序号 | 测试项 | 方法 | 通过准则 |
|------|--------|------|---------|
| 1 | 消息格式正确性 | 协议分析仪解析 | 所有字段符合定义 |
| 2 | 消息周期准确性 | 时间戳分析 | 周期偏差 < ±10% |
| 3 | CRC 校验 | 自动校验 | 0% 校验失败率 |
| 4 | 时间同步 | GPS 对比 | 同步误差 < 1 ms |
| 5 | 数据范围 | 边界值测试 | 所有数据在有效范围内 |
| 6 | 丢包率 | 序列号检测 | 丢包率 < 0.1% |
| 7 | 延迟 | 回环测试 | 单跳延迟 < 1 ms |
| 8 | 最大负载 | 压力测试 | 50目标时不溢出 |

### 9.2 接口仿真工具

建议开发以下测试工具：
- **传感器数据模拟器**：生成各传感器的仿真量测数据
- **协议分析工具**：实时解析和显示所有消息
- **回放工具**：回放记录数据进行离线分析

---

*文档结束*
