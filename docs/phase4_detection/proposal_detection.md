# 目标检测模块 — 技术方案文档

## 1. 概述与目标

目标检测模块负责在双目图像中定位无人机目标，输出检测框和置信度。该模块
是整个处理流水线的入口，其检测率和虚警率直接决定系统整体性能。

### 1.1 关键挑战

- **小目标检测**：远距离（>1000m）无人机仅占数像素
- **运动模糊**：帧间位移 2.3m（1000 km/h 相对速度）导致目标模糊
- **实时性**：单帧推理 < 3ms（部署目标）
- **杂波背景**：天空、云层、鸟群等干扰

---

## 2. 需求分析

| 指标 | 目标值 | 约束 |
|------|--------|------|
| 检测率 (Pd) | > 95% @ 500m | 定义为 IoU>0.3 的正确检测 |
| 虚警率 (Pfa) | < 1% / 帧 | 包含所有非目标检测 |
| 推理延迟 | < 3ms | TensorRT INT8 |
| 输入分辨率 | 1920×1080 | Full HD |
| 检测目标尺寸 | 2px ~ 200px | 远近目标共存 |

---

## 3. 候选方案对比

### 3.1 方案A：YOLOv8n

- **参数量**：3.2M
- **推理延迟**：~3ms (TensorRT INT8, Jetson Orin)
- **小目标能力**：★★★ (原生3尺度检测)
- **优势**：生态成熟、部署工具完善、单阶段低延迟
- **劣势**：原生P3最小特征图对极小目标(2-5px)不够细

### 3.2 方案B：YOLOv11n

- **参数量**：2.6M
- **推理延迟**：~2.5ms
- **小目标能力**：★★★★ (改进的C2f结构)
- **优势**：更轻量、更快、最新架构
- **劣势**：生态相对较新

### 3.3 方案C：RT-DETR-L

- **参数量**：32M
- **推理延迟**：~8ms
- **小目标能力**：★★★★ (Transformer全局注意力)
- **优势**：端到端无NMS、全局上下文感知
- **劣势**：模型大、延迟高、不满足3ms要求

### 3.4 方案D：模拟检测器（仿真专用）

- **参数量**：0
- **推理延迟**：~0ms
- **精度**：由 Ground Truth + 噪声模型决定
- **优势**：无 GPU 依赖、精确控制噪声特性
- **劣势**：不反映真实网络的检测特性

### 3.5 方案对比矩阵

| 维度 | YOLOv8n | YOLOv11n | RT-DETR | 模拟检测器 |
|------|:-------:|:--------:|:-------:|:----------:|
| 满足3ms要求 | ⚠️ | ✅ | ❌ | ✅ |
| 小目标检测 | ★★★ | ★★★★ | ★★★★ | ★★★★★ |
| GPU 需求 | 需要 | 需要 | 需要 | **不需要** |
| 部署就绪度 | ★★★★★ | ★★★★ | ★★★ | N/A |
| 仿真适用性 | ★★ | ★★ | ★★ | **★★★★★** |

---

## 4. 推荐方案及理由

### 4.1 仿真阶段：模拟检测器

**理由**：
1. 当前环境无 GPU，真实网络无法运行
2. 模拟检测器可精确控制检测特性（噪声、漏检、虚警），
   便于隔离验证下游模块的正确性
3. 通过 `DetectorBase` 抽象接口预留，未来可无缝替换

### 4.2 部署阶段推荐：YOLOv8n + 小目标增强

改进措施：

1. **P2 检测头**：增加 1/4 下采样层的检测头，提升 2-10px
   小目标检测能力。代价：参数增加约 0.5M。

2. **SAHI 切片推理**：将 1920×1080 图像切为重叠的子区域
   （如 640×640），分别推理后合并。适合远距离小目标。
   代价：增加 3-4 倍推理量，可通过 ROI 预测缓解。

3. **注意力机制 (CBAM)**：在 Neck 添加通道+空间注意力，
   增强目标区域响应。代价：增加 ~0.1ms 延迟。

### 4.3 运动模糊对检测性能的影响

在 1000 km/h 相对速度、120fps 帧率下：
- 帧间位移：278 m/s ÷ 120 fps ≈ 2.3 m/帧
- 曝光时间 1ms 内位移：0.28 m
- 在 100m 距离，0.28m 对应约 3.4 像素的模糊
- 在 500m 距离，0.28m 对应约 0.7 像素的模糊

**结论**：远距离运动模糊影响较小；近距离（<200m）需要
短曝光（<0.5ms）或去模糊预处理。

---

## 5. 检测概率建模

### 5.1 距离-检测概率模型

采用 Sigmoid 衰减函数：

```
P_d(r) = P_base / (1 + exp((r - r_half) / scale))
```

其中：
- P_base = 0.98（100m 处基准检测率）
- r_half = 1500m（半衰距离）
- scale = r_half / 5 = 300m

| 距离 (m) | P_d | 说明 |
|----------|-----|------|
| 100 | 0.98 | 近距离，几乎必检测 |
| 500 | 0.95 | 高可靠性 |
| 1000 | 0.84 | 开始衰减 |
| 1500 | 0.49 | 半衰距离 |
| 2000 | 0.16 | 显著降低 |
| 3000 | 0.01 | 接近不可检测 |

### 5.2 检测框噪声模型

bbox 位置噪声（高斯分布）：

```
σ_bbox = σ_base × (distance / 100)
```

其中 σ_base = 2.0 像素，即 100m 处 bbox 偏移标准差为 2px。

### 5.3 虚警生成模型

每帧虚警数量服从泊松分布：

```
N_FA ~ Poisson(λ)
```

默认 λ = 0.005（每200帧约1个虚警）。

虚警位置在图像中均匀随机分布，尺寸随机（5-30 × 3-15 像素）。

---

## 6. 风险评估

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| 模拟检测器不反映真实网络特性 | 确定 | 中 | 接口预留，参数可调 |
| 远距离目标漏检率高 | 高 | 中 | 融合尺寸先验 + 预测驱动 |
| 运动模糊降低检测精度 | 中 | 低 | 短曝光 + 去模糊预处理 |
| 天空背景变化导致虚警 | 中 | 低 | 置信度阈值过滤 |

---

## 7. 参考资料

1. Ultralytics YOLOv8 Documentation. https://docs.ultralytics.com/
2. Akyon, F.C. et al. "Slicing Aided Hyper Inference (SAHI)." 2022.
3. Woo, S. et al. "CBAM: Convolutional Block Attention Module." ECCV, 2018.
4. Lyu, C. et al. "RT-DETR: DETRs Beat YOLOs on Real-time Object Detection." 2023.
